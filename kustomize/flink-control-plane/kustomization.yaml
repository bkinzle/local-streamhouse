apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- helm-output.yaml  # ephemeral file generated by helm template command

patches:
# removes flink-conf.yaml from the flink-operator-config ConfigMap
- target:
    kind: ConfigMap
    name: flink-operator-config
  patch: |-
    - op: remove
      path: /data/flink-conf.yaml
# changes volume to use the config.yaml key instead of flink-conf.yaml from the ConfigMap
- target:
    kind: Deployment
    name: flink-kubernetes-operator
  patch: |-
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: flink-kubernetes-operator
    spec:
      template:
        spec:
          volumes:
          - name: flink-operator-config-volume
            configMap:
              name: flink-operator-config
              defaultMode: 420
              items:
              - key: config.yaml
                path: config.yaml
              - key: log4j-operator.properties
                path: log4j-operator.properties
              - key: log4j-console.properties
                path: log4j-console.properties
